<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>50 Sounds Practice / æ—¥æ–‡äº”åéŸ³ç·´ç¿’å™¨</title>
    <style>
        body { font-family: "Helvetica", sans-serif; text-align: center; margin: 40px; background: #f7f7f7; }
        h1 { color: #2c3e50; }
        input, button, select { padding: 10px; font-size: 16px; }
        .kana { font-size: 72px; margin: 20px; }
        .result { font-size: 18px; margin-top: 20px; }
        .quiz-container { display: flex; justify-content: center; align-items: center; gap: 30px; margin-top: 30px; }
        #checkbox-mode label { margin-right: 10px; }
    </style>
</head>
<body>
    <h1 id="title">ğŸŒ æ—¥æ–‡äº”åéŸ³ç·´ç¿’å™¨</h1>

    <!-- æ¨¡å¼é¸æ“‡ -->
    <div id="mode-select">
        <label><input type="radio" name="mode" value="range" checked onchange="toggleMode(this.value)"><span id="label-range">ç¯„åœè¼¸å…¥</span></label>
        <label><input type="radio" name="mode" value="checkbox" onchange="toggleMode(this.value)"><span id="label-checkbox">è¡Œé¸å–</span></label>
    </div>

    <!-- ç¯„åœè¼¸å…¥æ¨¡å¼ -->
    <div id="range-mode">
        <label for="language">ğŸŒ èªè¨€ Language:</label>
        <select id="language" onchange="setLanguage()">
            <option value="zh">ç¹é«”ä¸­æ–‡</option>
            <option value="en">English</option>
        </select>

        <p id="instructions">è¼¸å…¥èµ·å§‹èˆ‡çµæŸå‡åï¼ˆä¾‹å¦‚ï¼šã‚ åˆ° ã“ï¼‰ï¼š</p>
        <input id="start" placeholder="èµ·å§‹å‡å"> ã€œ 
        <input id="end" placeholder="çµæŸå‡å">
        <button class="startBtn" onclick="startQuiz()">é–‹å§‹ç·´ç¿’</button>
    </div>

    <!-- è¡Œé¸å–æ¨¡å¼ -->
    <div id="checkbox-mode" style="display:none;">
        <p id="checkboxInstructions">é¸æ“‡è¦ç·´ç¿’çš„è¡Œï¼š</p>
        <label><input type="checkbox" name="row" value="a"><span class="row-label" data-row="a">ã‚è¡Œ</span></label>
        <label><input type="checkbox" name="row" value="k"><span class="row-label" data-row="k">ã‹è¡Œ</span></label>
        <label><input type="checkbox" name="row" value="s"><span class="row-label" data-row="s">ã•è¡Œ</span></label>
        <label><input type="checkbox" name="row" value="t"><span class="row-label" data-row="t">ãŸè¡Œ</span></label>
        <label><input type="checkbox" name="row" value="n"><span class="row-label" data-row="n">ãªè¡Œ</span></label>
        <label><input type="checkbox" name="row" value="h"><span class="row-label" data-row="h">ã¯è¡Œ</span></label>
        <label><input type="checkbox" name="row" value="m"><span class="row-label" data-row="m">ã¾è¡Œ</span></label>
        <label><input type="checkbox" name="row" value="y"><span class="row-label" data-row="y">ã‚„è¡Œ</span></label>
        <label><input type="checkbox" name="row" value="r"><span class="row-label" data-row="r">ã‚‰è¡Œ</span></label>
        <label><input type="checkbox" name="row" value="w"><span class="row-label" data-row="w">ã‚è¡Œ</span></label>
        <label><input type="checkbox" name="row" value="nn"><span class="row-label" data-row="nn">ã‚“è¡Œ</span></label>
        <br><button class="startBtn" onclick="startQuiz()">é–‹å§‹ç·´ç¿’</button>
    </div>

    <div id="quiz" style="display:none;">
        <div class="quiz-container" style="flex-direction: column;">
            <div class="kana" id="kana"></div>
            <input id="answer" placeholder="è¼¸å…¥ç¾…é¦¬æ‹¼éŸ³" onkeydown="if(event.key==='Enter') checkAnswer()">
            <button onclick="checkAnswer()" id="submitBtn">é€å‡º</button>
            <div class="result" id="feedback"></div>
            <!-- ä¿ç•™åŸæœ¬çš„å’–æ³¢ç¨®å­ GIF -->
            <img src="å’–æ³¢ç¨®å­.gif" alt="å’–æ³¢ç¨®å­ GIF" style="width:300px; height:auto; margin-top: 20px;">
        </div>
    </div>

    <script>
    const chart = [
        ["ã‚", "a"], ["ã„", "i"], ["ã†", "u"], ["ãˆ", "e"], ["ãŠ", "o"],
        ["ã‹", "ka"], ["ã", "ki"], ["ã", "ku"], ["ã‘", "ke"], ["ã“", "ko"],
        ["ã•", "sa"], ["ã—", "shi"], ["ã™", "su"], ["ã›", "se"], ["ã", "so"],
        ["ãŸ", "ta"], ["ã¡", "chi"], ["ã¤", "tsu"], ["ã¦", "te"], ["ã¨", "to"],
        ["ãª", "na"], ["ã«", "ni"], ["ã¬", "nu"], ["ã­", "ne"], ["ã®", "no"],
        ["ã¯", "ha"], ["ã²", "hi"], ["ãµ", "fu"], ["ã¸", "he"], ["ã»", "ho"],
        ["ã¾", "ma"], ["ã¿", "mi"], ["ã‚€", "mu"], ["ã‚", "me"], ["ã‚‚", "mo"],
        ["ã‚„", "ya"], ["ã‚†", "yu"], ["ã‚ˆ", "yo"],
        ["ã‚‰", "ra"], ["ã‚Š", "ri"], ["ã‚‹", "ru"], ["ã‚Œ", "re"], ["ã‚", "ro"],
        ["ã‚", "wa"], ["ã‚’", "wo"], ["ã‚“", "n"]
    ];

    const rowMap = {
        a: ["ã‚","ã„","ã†","ãˆ","ãŠ"],
        k: ["ã‹","ã","ã","ã‘","ã“"],
        s: ["ã•","ã—","ã™","ã›","ã"],
        t: ["ãŸ","ã¡","ã¤","ã¦","ã¨"],
        n: ["ãª","ã«","ã¬","ã­","ã®"],
        h: ["ã¯","ã²","ãµ","ã¸","ã»"],
        m: ["ã¾","ã¿","ã‚€","ã‚","ã‚‚"],
        y: ["ã‚„","ã‚†","ã‚ˆ"],
        r: ["ã‚‰","ã‚Š","ã‚‹","ã‚Œ","ã‚"],
        w: ["ã‚","ã‚’"],
        nn: ["ã‚“"]
    };

    // ç”¨æ–¼è¡Œæ¨™ç±¤çš„å‡åå°æ‡‰
    const rowKana = { a:"ã‚", k:"ã‹", s:"ã•", t:"ãŸ", n:"ãª", h:"ã¯", m:"ã¾", y:"ã‚„", r:"ã‚‰", w:"ã‚", nn:"ã‚“" };

    const romajiToKana = Object.fromEntries(chart.map(([k,r]) => [r,k]));
    let selected = [], current = 0, score = 0;
    let lang = "zh";

    const texts = {
        zh: {
            title: "ğŸŒ æ—¥æ–‡äº”åéŸ³ç·´ç¿’å™¨",
            instructions: "è¼¸å…¥èµ·å§‹èˆ‡çµæŸå‡åï¼ˆä¾‹å¦‚ï¼šã‚ åˆ° ã“ï¼‰ï¼š",
            startBtn: "é–‹å§‹ç·´ç¿’",
            submitBtn: "é€å‡º",
            correct: "âœ… æ­£ç¢ºï¼",
            wrong: correct => `âŒ éŒ¯èª¤ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ ${correct}`,
            score: (score, total) => `ğŸŒŸ å¾—åˆ†ï¼š${score} / ${total}`,
            alert: "âš ï¸ è«‹å…ˆé¸æ“‡æœ‰æ•ˆç¯„åœæˆ–è‡³å°‘ä¸€å€‹è¡Œï¼",
            inputPlaceholder: "è¼¸å…¥ç¾…é¦¬æ‹¼éŸ³",
            checkboxLabel: "é¸æ“‡è¦ç·´ç¿’çš„è¡Œï¼š",
            modeRangeLabel: "ç¯„åœè¼¸å…¥",
            modeCheckboxLabel: "è¡Œé¸å–"
        },
        en: {
            title: "ğŸŒ 50 Sounds Practice",
            instructions: "Enter start and end kana (e.g., ã‚ to ã“):",
            startBtn: "Start Quiz",
            submitBtn: "Submit",
            correct: "âœ… Correct!",
            wrong: correct => `âŒ Incorrect, correct answer: ${correct}`,
            score: (score, total) => `ğŸŒŸ Score: ${score} / ${total}`,
            alert: "âš ï¸ Invalid range or no row selected!",
            inputPlaceholder: "Enter romaji",
            checkboxLabel: "Select rows to practice:",
            modeRangeLabel: "Range Input",
            modeCheckboxLabel: "Select Rows"
        }
    };

    function toggleMode(value) {
        document.getElementById('range-mode').style.display = value==='range' ? 'block' : 'none';
        document.getElementById('checkbox-mode').style.display = value==='checkbox' ? 'block' : 'none';
    }

    function setLanguage() {
        lang = document.getElementById("language").value;
        const t = texts[lang];
        document.getElementById("title").innerText = t.title;
        document.getElementById("instructions").innerText = t.instructions;
        document.getElementById("submitBtn").innerText = t.submitBtn;
        document.getElementById("answer").placeholder = t.inputPlaceholder;
        document.getElementById("start").placeholder = lang === 'en' ? 'Start kana (e.g. a)' : 'èµ·å§‹å‡å';
        document.getElementById("end").placeholder = lang === 'en' ? 'End kana (e.g. ko)' : 'çµæŸå‡å';
        document.getElementById("checkboxInstructions").innerText = t.checkboxLabel;
        document.getElementById('label-range').innerText = t.modeRangeLabel;
        document.getElementById('label-checkbox').innerText = t.modeCheckboxLabel;
        document.querySelectorAll(".startBtn").forEach(btn => btn.innerText = t.startBtn);
        // æ›´æ–°æ¯å€‹è¡Œæ¨™ç±¤
        document.querySelectorAll('.row-label').forEach(span => {
            const row = span.dataset.row;
            span.innerText = lang==='en' ? `${rowKana[row]} row` : `${rowKana[row]}è¡Œ`;
        });
    }

    function normalize(input) {
        if (chart.find(p => p[0] === input)) return input;
        return romajiToKana[input.toLowerCase()] || "";
    }

    function startQuiz() {
        const mode = document.querySelector('input[name="mode"]:checked').value;
        let kanaList = [];
        if (mode === 'range') {
            const startKana = normalize(document.getElementById("start").value.trim());
            const endKana = normalize(document.getElementById("end").value.trim());
            const startIndex = chart.findIndex(p => p[0] === startKana);
            const endIndex = chart.findIndex(p => p[0] === endKana);
            if (startIndex === -1 || endIndex === -1 || startIndex > endIndex) {
                alert(texts[lang].alert);
                return;
            }
            kanaList = chart.slice(startIndex, endIndex + 1);
        } else {
            const checked = Array.from(document.querySelectorAll('input[name="row"]:checked')).map(cb => cb.value);
            if (checked.length === 0) {
                alert(texts[lang].alert);
                return;
            }
            checked.forEach(row => {
                rowMap[row].forEach(k => kanaList.push([k, chart.find(c=>c[0]===k)[1]]));
            });
        }
        selected = shuffle(kanaList);
        current = 0;
        score = 0;
        document.getElementById("quiz").style.display = "block";
        document.getElementById("feedback").innerText = "";
        document.getElementById("answer").style.display = "inline";
        document.getElementById("submitBtn").style.display = "inline";
        nextQuestion();
    }

    function nextQuestion() {
        if (current >= selected.length) {
            document.getElementById("kana").innerText = texts[lang].score(score, selected.length);
            document.getElementById("answer").style.display = "none";
            document.getElementById("submitBtn").style.display = "none";
            return;
        }
        document.getElementById("kana").innerText = selected[current][0];
        document.getElementById("answer").value = "";
        document.getElementById("answer").focus();
    }

    function checkAnswer() {
        const user = document.getElementById("answer").value.trim().toLowerCase();
        const char = selected[current][0];
        // å¦‚æœæ˜¯ "ã‚’"ï¼Œæ¥å— "wo" æˆ– "o"
        const correctAnswers = char === "ã‚’" ? ["wo", "o"] : [selected[current][1]];
        const feedback = document.getElementById("feedback");
        if (correctAnswers.includes(user)) {
            feedback.innerText = texts[lang].correct;
            score++;
        } else {
            feedback.innerText = texts[lang].wrong(correctAnswers[0]);
        }
        current++;
        setTimeout(() => {
            feedback.innerText = "";
            nextQuestion();
        }, 1000);
    }

    function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    window.onload = setLanguage;
    </script>
</body>
</html>
