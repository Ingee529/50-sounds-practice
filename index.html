<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Complete Japanese Kana Practice / å®Œæ•´æ—¥æ–‡äº”åéŸ³ç·´ç¿’å™¨</title>
    <style>
        body { 
            font-family: "Helvetica", "Yu Gothic", sans-serif; 
            text-align: center; 
            margin: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        .page-content {
            display: block;
        }
        .page-content.hidden {
            display: none;
        }
        .container {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        h1 { color: #2c3e50; margin-bottom: 30px; }
        .nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 5px;
        }
        .nav-tab {
            padding: 12px 24px;
            cursor: pointer;
            border-radius: 8px;
            margin: 0 5px;
            transition: all 0.3s;
            font-weight: 500;
        }
        .nav-tab.active {
            background: #667eea;
            color: white;
        }
        .nav-tab:hover {
            background: #e9ecef;
        }
        .nav-tab.active:hover {
            background: #5a6fd8;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        input, button, select { 
            padding: 12px; 
            font-size: 16px; 
            border: 2px solid #ddd;
            border-radius: 8px;
            margin: 5px;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }
        button:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        .kana { 
            font-size: 72px; 
            margin: 20px; 
            color: #2c3e50;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        .result { 
            font-size: 18px; 
            margin-top: 20px; 
            font-weight: 500;
        }
        .quiz-container { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            gap: 30px; 
            margin-top: 30px; 
        }
        .mode-select { 
            display: flex; 
            justify-content: center; 
            gap: 20px; 
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .mode-select label { 
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .mode-select label:hover {
            background: #e9ecef;
        }
        .checkbox-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px; 
            margin: 20px 0;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        .checkbox-group { 
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        .checkbox-group:hover {
            border-color: #667eea;
        }
        .checkbox-group h4 {
            margin: 0 0 10px 0;
            color: #667eea;
            font-size: 16px;
        }
        .checkbox-group label { 
            display: block;
            margin: 8px 0;
            text-align: left;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: background 0.2s;
        }
        .checkbox-group label:hover {
            background: rgba(102, 126, 234, 0.1);
        }
        .chart-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .chart-table th, .chart-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #e9ecef;
        }
        .chart-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }
        .chart-table td {
            font-size: 18px;
            transition: background 0.2s;
        }
        .chart-table td:hover {
            background: #f8f9fa;
        }
        .kana-char {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        .romaji {
            font-size: 14px;
            color: #666;
            font-family: monospace;
        }
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
            border-radius: 4px;
        }
        .stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .stat-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            min-width: 120px;
            margin: 5px;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        .stat-label {
            font-size: 14px;
            color: #666;
        }
        @media (max-width: 768px) {
            .container { margin: 10px; padding: 20px; }
            .kana { font-size: 48px; }
            .checkbox-grid { grid-template-columns: 1fr; }
            .quiz-container { flex-direction: column; gap: 15px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="title">ğŸŒ æ—¥æ–‡äº”åéŸ³ç·´ç¿’å™¨</h1>
        <p style="margin: -10px 0 20px 0; color: #666; font-size: 14px;">ä½œè€…: Ingee</p>

        <!-- èªè¨€é¸æ“‡ -->
        <div style="margin-bottom: 20px;">
            <label for="language">ğŸŒ èªè¨€ Language:</label>
            <select id="language" onchange="setLanguage()">
                <option value="zh">ç¹é«”ä¸­æ–‡</option>
                <option value="en">English</option>
            </select>
        </div>

        <!-- å°èˆªæ¨™ç±¤ -->
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="showTab('practice')">
                <span id="nav-practice">ç·´ç¿’æ¨¡å¼</span>
            </div>
            <div class="nav-tab" onclick="showTab('chart')">
                <span id="nav-chart">äº”åéŸ³è¡¨</span>
            </div>
        </div>

        <!-- ç·´ç¿’æ¨¡å¼æ¨™ç±¤å…§å®¹ -->
        <div id="practice-tab" class="tab-content active">
            <!-- å‡åé¡å‹é¸æ“‡ -->
            <div class="mode-select">
                <label>
                    <input type="radio" name="kana-type" value="hiragana" checked                     onclick="
                        document.getElementById('cat-dakuten').textContent = 'æ¿éŸ³ (ãŒ,ã–,ã ,ã°)';
                        document.getElementById('cat-handakuten').textContent = 'åŠæ¿éŸ³ (ã±è¡Œ)';
                        document.getElementById('cat-youon').textContent = 'æ‹—éŸ³ (ãã‚ƒ,ã—ã‚ƒ,ã¡ã‚ƒ...)';
                    ">
                    <span id="type-hiragana">å¹³å‡å (ã²ã‚‰ãŒãª)</span>
                </label>
                <label>
                    <input type="radio" name="kana-type" value="katakana"                     onclick="
                        document.getElementById('cat-dakuten').textContent = 'æ¿éŸ³ (ã‚¬,ã‚¶,ãƒ€,ãƒ)';
                        document.getElementById('cat-handakuten').textContent = 'åŠæ¿éŸ³ (ãƒ‘è¡Œ)';
                        document.getElementById('cat-youon').textContent = 'æ‹—éŸ³ (ã‚­ãƒ£,ã‚·ãƒ£,ãƒãƒ£...)';
                    ">
                    <span id="type-katakana">ç‰‡å‡å (ã‚«ã‚¿ã‚«ãƒŠ)</span>
                </label>
                <label>
                    <input type="radio" name="kana-type" value="mixed"                     onclick="
                        document.getElementById('cat-dakuten').textContent = 'æ¿éŸ³ (ãŒ,ã–,ã ,ã°)';
                        document.getElementById('cat-handakuten').textContent = 'åŠæ¿éŸ³ (ã±è¡Œ)';
                        document.getElementById('cat-youon').textContent = 'æ‹—éŸ³ (ãã‚ƒ,ã—ã‚ƒ,ã¡ã‚ƒ...)';
                    ">
                    <span id="type-mixed">æ··åˆç·´ç¿’</span>
                </label>
            </div>

            <!-- ç·´ç¿’ç¯„åœé¸æ“‡ -->
            <div class="checkbox-grid">
                <div class="checkbox-group">
                    <h4 id="group-basic">åŸºæœ¬éŸ³</h4>
                    <label><input type="checkbox" name="category" value="basic" checked> <span id="cat-basic">æ¸…éŸ³ (äº”åéŸ³)</span></label>
                </div>
                <div class="checkbox-group">
                    <h4 id="group-dakuten">æ¿éŸ³</h4>
                    <label><input type="checkbox" name="category" value="dakuten"> <span id="cat-dakuten">æ¿éŸ³ (ãŒ,ã–,ã ,ã°)</span></label>
                </div>
                <div class="checkbox-group">
                    <h4 id="group-handakuten">åŠæ¿éŸ³</h4>
                    <label><input type="checkbox" name="category" value="handakuten"> <span id="cat-handakuten">åŠæ¿éŸ³ (ã±è¡Œ)</span></label>
                </div>
                <div class="checkbox-group">
                    <h4 id="group-youon">æ‹—éŸ³</h4>
                    <label><input type="checkbox" name="category" value="youon"> <span id="cat-youon">æ‹—éŸ³ (ãã‚ƒ,ã—ã‚ƒ,ã¡ã‚ƒ...)</span></label>
                </div>
            </div>
            </div>

                            <button id="start-btn" onclick="startQuiz()">é–‹å§‹ç·´ç¿’</button>

                <!-- æ¸¬é©—å€åŸŸ -->
                <div id="quiz-area" style="display: none;">
                    <!-- é€²åº¦æ¢ -->
                    <div class="progress-bar" style="width: 100%; height: 8px; background: #e9ecef; border-radius: 4px; overflow: hidden; margin: 10px 0;">
                        <div class="progress-fill" id="progress" style="height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); transition: width 0.5s ease; border-radius: 4px; width: 0%;"></div>
                    </div>
                    
                    <!-- çµ±è¨ˆè³‡è¨Š -->
                    <div class="stats" style="display: flex; justify-content: space-around; margin: 20px 0; flex-wrap: wrap;">
                        <div class="stat-item" style="background: #f8f9fa; padding: 15px; border-radius: 10px; min-width: 120px; margin: 5px;">
                            <div class="stat-number" id="current-num" style="font-size: 24px; font-weight: bold; color: #667eea;">1</div>
                            <div class="stat-label" id="stat-current" style="font-size: 14px; color: #666;">ç•¶å‰é¡Œç›®</div>
                        </div>
                        <div class="stat-item" style="background: #f8f9fa; padding: 15px; border-radius: 10px; min-width: 120px; margin: 5px;">
                            <div class="stat-number" id="total-num" style="font-size: 24px; font-weight: bold; color: #667eea;">0</div>
                            <div class="stat-label" id="stat-total" style="font-size: 14px; color: #666;">ç¸½é¡Œæ•¸</div>
                        </div>
                        <div class="stat-item" style="background: #f8f9fa; padding: 15px; border-radius: 10px; min-width: 120px; margin: 5px;">
                            <div class="stat-number" id="score-num" style="font-size: 24px; font-weight: bold; color: #667eea;">0</div>
                            <div class="stat-label" id="stat-score" style="font-size: 14px; color: #666;">æ­£ç¢ºæ•¸</div>
                        </div>
                        <div class="stat-item" style="background: #f8f9fa; padding: 15px; border-radius: 10px; min-width: 120px; margin: 5px;">
                            <div class="stat-number" id="accuracy" style="font-size: 24px; font-weight: bold; color: #667eea;">0%</div>
                            <div class="stat-label" id="stat-accuracy" style="font-size: 14px; color: #666;">æ­£ç¢ºç‡</div>
                        </div>
                    </div>

                    <!-- æ¸¬é©—å€ -->
                    <div class="quiz-container" style="display: flex; justify-content: center; align-items: center; gap: 30px; margin-top: 30px; flex-direction: column;">
                        <div class="kana" id="kana" style="font-size: 72px; margin: 20px; color: #2c3e50; text-shadow: 2px 2px 4px rgba(0,0,0,0.1);"></div>
                        <input id="answer" placeholder="è¼¸å…¥ç¾…é¦¬æ‹¼éŸ³" onkeydown="if(event.key==='Enter') checkAnswer()" style="padding: 12px; font-size: 16px; border: 2px solid #ddd; border-radius: 8px; margin: 5px;">
                        <button onclick="checkAnswer()" id="submit-btn" style="padding: 12px; font-size: 16px; border: 2px solid #ddd; border-radius: 8px; margin: 5px; background: #667eea; color: white; border: none; cursor: pointer;">é€å‡º</button>
                        <div class="result" id="feedback" style="font-size: 18px; margin-top: 20px; font-weight: 500;"></div>
                        <img src="å’–æ³¢ç¨®å­.gif" alt="å’–æ³¢ç¨®å­ GIF" style="width:300px; height:auto; margin-top: 20px;">
                    </div>
                </div>

            <!-- æ¸¬é©—å€ -->
            <div id="quiz" style="display:none;">
                <!-- é€²åº¦æ¢ -->
                <div class="progress-bar">
                    <div class="progress-fill" id="progress"></div>
                </div>
                
                <!-- çµ±è¨ˆè³‡è¨Š -->
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-number" id="current-num">1</div>
                        <div class="stat-label" id="stat-current">ç•¶å‰é¡Œç›®</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="total-num">0</div>
                        <div class="stat-label" id="stat-total">ç¸½é¡Œæ•¸</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="score-num">0</div>
                        <div class="stat-label" id="stat-score">æ­£ç¢ºæ•¸</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="accuracy">0%</div>
                        <div class="stat-label" id="stat-accuracy">æ­£ç¢ºç‡</div>
                    </div>
                </div>

                <div class="quiz-container" style="flex-direction: column;">
                    <div class="kana" id="kana"></div>
                    <input id="answer" placeholder="è¼¸å…¥ç¾…é¦¬æ‹¼éŸ³" onkeydown="if(event.key==='Enter') checkAnswer()">
                    <button onclick="checkAnswer()" id="submit-btn">é€å‡º</button>
                    <div class="result" id="feedback"></div>
                    <img src="å’–æ³¢ç¨®å­.gif" alt="å’–æ³¢ç¨®å­ GIF" style="width:300px; height:auto; margin-top: 20px;">
                </div>
            </div>
        </div>

        <!-- äº”åéŸ³è¡¨æ¨™ç±¤å…§å®¹ -->
        <div id="chart-tab" class="tab-content">
            <div class="mode-select">
                <label>
                    <input type="radio" name="chart-type" value="hiragana" checked onchange="updateChart()">
                    <span id="chart-hiragana-label">å¹³å‡å</span>
                </label>
                <label>
                    <input type="radio" name="chart-type" value="katakana" onchange="updateChart()">
                    <span id="chart-katakana-label">ç‰‡å‡å</span>
                </label>
            </div>
            <div id="kana-chart"></div>
            
            <!-- æ¦‚å¿µå±•ç¤ºå€ -->
            <div style="margin: 30px 0;">
                <div class="checkbox-grid" style="pointer-events: none;">
                    <div class="checkbox-group" style="background: #f0f4ff; border: 2px solid #667eea;">
                        <h4 id="group-sokuon">ä¿ƒéŸ³</h4>
                        <p style="font-size: 14px; color: #666; margin: 5px 0; text-align: left;" id="sokuon-desc">
                            å°ã¤ (ã£)ï¼Œç™¼éŸ³æ™‚åœé “ä¸€æ‹<br>
                            ä¾‹ï¼šãã£ã· (kippu)ã€ãŒã£ã“ã† (gakkou)
                        </p>
                    </div>
                    <div class="checkbox-group" style="background: #f0f4ff; border: 2px solid #667eea;">
                        <h4 id="group-chouon">é•·éŸ³</h4>
                        <p style="font-size: 14px; color: #666; margin: 5px 0; text-align: left;" id="chouon-desc">
                            æ¯éŸ³å»¶é•·ï¼ŒæŒçºŒå…©æ‹<br>
                            ä¾‹ï¼šãŠã‹ã‚ã•ã‚“ (okaasan)ã€ã‚³ãƒ¼ãƒ’ãƒ¼ (koohii)
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    // å®Œæ•´çš„å‡åæ•¸æ“š
    const kanaData = {
        basic: {
            hiragana: [
                ["ã‚","a"],["ã„","i"],["ã†","u"],["ãˆ","e"],["ãŠ","o"],
                ["ã‹","ka"],["ã","ki"],["ã","ku"],["ã‘","ke"],["ã“","ko"],
                ["ã•","sa"],["ã—","shi"],["ã™","su"],["ã›","se"],["ã","so"],
                ["ãŸ","ta"],["ã¡","chi"],["ã¤","tsu"],["ã¦","te"],["ã¨","to"],
                ["ãª","na"],["ã«","ni"],["ã¬","nu"],["ã­","ne"],["ã®","no"],
                ["ã¯","ha"],["ã²","hi"],["ãµ","fu"],["ã¸","he"],["ã»","ho"],
                ["ã¾","ma"],["ã¿","mi"],["ã‚€","mu"],["ã‚","me"],["ã‚‚","mo"],
                ["ã‚„","ya"],["ã‚†","yu"],["ã‚ˆ","yo"],
                ["ã‚‰","ra"],["ã‚Š","ri"],["ã‚‹","ru"],["ã‚Œ","re"],["ã‚","ro"],
                ["ã‚","wa"],["ã‚’","wo"],["ã‚“","n"]
            ],
            katakana: [
                ["ã‚¢","a"],["ã‚¤","i"],["ã‚¦","u"],["ã‚¨","e"],["ã‚ª","o"],
                ["ã‚«","ka"],["ã‚­","ki"],["ã‚¯","ku"],["ã‚±","ke"],["ã‚³","ko"],
                ["ã‚µ","sa"],["ã‚·","shi"],["ã‚¹","su"],["ã‚»","se"],["ã‚½","so"],
                ["ã‚¿","ta"],["ãƒ","chi"],["ãƒ„","tsu"],["ãƒ†","te"],["ãƒˆ","to"],
                ["ãƒŠ","na"],["ãƒ‹","ni"],["ãƒŒ","nu"],["ãƒ","ne"],["ãƒ","no"],
                ["ãƒ","ha"],["ãƒ’","hi"],["ãƒ•","fu"],["ãƒ˜","he"],["ãƒ›","ho"],
                ["ãƒ","ma"],["ãƒŸ","mi"],["ãƒ ","mu"],["ãƒ¡","me"],["ãƒ¢","mo"],
                ["ãƒ¤","ya"],["ãƒ¦","yu"],["ãƒ¨","yo"],
                ["ãƒ©","ra"],["ãƒª","ri"],["ãƒ«","ru"],["ãƒ¬","re"],["ãƒ­","ro"],
                ["ãƒ¯","wa"],["ãƒ²","wo"],["ãƒ³","n"]
            ]
        },
        dakuten: {
            hiragana: [
                ["ãŒ","ga"],["ã","gi"],["ã","gu"],["ã’","ge"],["ã”","go"],
                ["ã–","za"],["ã˜","ji/zi"],["ãš","zu"],["ãœ","ze"],["ã","zo"],
                ["ã ","da"],["ã¢","di/ji"],["ã¥","du/zu"],["ã§","de"],["ã©","do"],
                ["ã°","ba"],["ã³","bi"],["ã¶","bu"],["ã¹","be"],["ã¼","bo"]
            ],
            katakana: [
                ["ã‚¬","ga"],["ã‚®","gi"],["ã‚°","gu"],["ã‚²","ge"],["ã‚´","go"],
                ["ã‚¶","za"],["ã‚¸","ji/zi"],["ã‚º","zu"],["ã‚¼","ze"],["ã‚¾","zo"],
                ["ãƒ€","da"],["ãƒ‚","di/ji"],["ãƒ…","du/zu"],["ãƒ‡","de"],["ãƒ‰","do"],
                ["ãƒ","ba"],["ãƒ“","bi"],["ãƒ–","bu"],["ãƒ™","be"],["ãƒœ","bo"]
            ]
        },
        handakuten: {
            hiragana: [
                ["ã±","pa"],["ã´","pi"],["ã·","pu"],["ãº","pe"],["ã½","po"]
            ],
            katakana: [
                ["ãƒ‘","pa"],["ãƒ”","pi"],["ãƒ—","pu"],["ãƒš","pe"],["ãƒ","po"]
            ]
        },
        youon: {
            hiragana: [
                ["ãã‚ƒ","kya"],["ãã‚…","kyu"],["ãã‚‡","kyo"],
                ["ã—ã‚ƒ","sha"],["ã—ã‚…","shu"],["ã—ã‚‡","sho"],
                ["ã¡ã‚ƒ","cha"],["ã¡ã‚…","chu"],["ã¡ã‚‡","cho"],
                ["ã«ã‚ƒ","nya"],["ã«ã‚…","nyu"],["ã«ã‚‡","nyo"],
                ["ã²ã‚ƒ","hya"],["ã²ã‚…","hyu"],["ã²ã‚‡","hyo"],
                ["ã¿ã‚ƒ","mya"],["ã¿ã‚…","myu"],["ã¿ã‚‡","myo"],
                ["ã‚Šã‚ƒ","rya"],["ã‚Šã‚…","ryu"],["ã‚Šã‚‡","ryo"],
                ["ãã‚ƒ","gya"],["ãã‚…","gyu"],["ãã‚‡","gyo"],
                ["ã˜ã‚ƒ","ja"],["ã˜ã‚…","ju"],["ã˜ã‚‡","jo"],
                ["ã¢ã‚ƒ","dya"],["ã¢ã‚…","dyu"],["ã¢ã‚‡","dyo"],
                ["ã³ã‚ƒ","bya"],["ã³ã‚…","byu"],["ã³ã‚‡","byo"],
                ["ã´ã‚ƒ","pya"],["ã´ã‚…","pyu"],["ã´ã‚‡","pyo"]
            ],
            katakana: [
                ["ã‚­ãƒ£","kya"],["ã‚­ãƒ¥","kyu"],["ã‚­ãƒ§","kyo"],
                ["ã‚·ãƒ£","sha"],["ã‚·ãƒ¥","shu"],["ã‚·ãƒ§","sho"],
                ["ãƒãƒ£","cha"],["ãƒãƒ¥","chu"],["ãƒãƒ§","cho"],
                ["ãƒ‹ãƒ£","nya"],["ãƒ‹ãƒ¥","nyu"],["ãƒ‹ãƒ§","nyo"],
                ["ãƒ’ãƒ£","hya"],["ãƒ’ãƒ¥","hyu"],["ãƒ’ãƒ§","hyo"],
                ["ãƒŸãƒ£","mya"],["ãƒŸãƒ¥","myu"],["ãƒŸãƒ§","myo"],
                ["ãƒªãƒ£","rya"],["ãƒªãƒ¥","ryu"],["ãƒªãƒ§","ryo"],
                ["ã‚®ãƒ£","gya"],["ã‚®ãƒ¥","gyu"],["ã‚®ãƒ§","gyo"],
                ["ã‚¸ãƒ£","ja"],["ã‚¸ãƒ¥","ju"],["ã‚¸ãƒ§","jo"],
                ["ãƒ‚ãƒ£","dya"],["ãƒ‚ãƒ¥","dyu"],["ãƒ‚ãƒ§","dyo"],
                ["ãƒ“ãƒ£","bya"],["ãƒ“ãƒ¥","byu"],["ãƒ“ãƒ§","byo"],
                ["ãƒ”ãƒ£","pya"],["ãƒ”ãƒ¥","pyu"],["ãƒ”ãƒ§","pyo"]
            ]
        }
    };

    // äº”åéŸ³è¡¨æ•¸æ“š
    const chartData = {
        basic: [
            ["","a","i","u","e","o"],
            ["","ã‚/ã‚¢","ã„/ã‚¤","ã†/ã‚¦","ãˆ/ã‚¨","ãŠ/ã‚ª"],
            ["k","ã‹/ã‚«","ã/ã‚­","ã/ã‚¯","ã‘/ã‚±","ã“/ã‚³"],
            ["s","ã•/ã‚µ","ã—/ã‚·","ã™/ã‚¹","ã›/ã‚»","ã/ã‚½"],
            ["t","ãŸ/ã‚¿","ã¡/ãƒ","ã¤/ãƒ„","ã¦/ãƒ†","ã¨/ãƒˆ"],
            ["n","ãª/ãƒŠ","ã«/ãƒ‹","ã¬/ãƒŒ","ã­/ãƒ","ã®/ãƒ"],
            ["h","ã¯/ãƒ","ã²/ãƒ’","ãµ/ãƒ•","ã¸/ãƒ˜","ã»/ãƒ›"],
            ["m","ã¾/ãƒ","ã¿/ãƒŸ","ã‚€/ãƒ ","ã‚/ãƒ¡","ã‚‚/ãƒ¢"],
            ["y","ã‚„/ãƒ¤","","ã‚†/ãƒ¦","","ã‚ˆ/ãƒ¨"],
            ["r","ã‚‰/ãƒ©","ã‚Š/ãƒª","ã‚‹/ãƒ«","ã‚Œ/ãƒ¬","ã‚/ãƒ­"],
            ["w","ã‚/ãƒ¯","","","","ã‚’/ãƒ² (wo/o)"],
            ["","","","","","ã‚“/ãƒ³"]
        ],
        dakuten: [
            ["","a","i","u","e","o"],
            ["g","ãŒ/ã‚¬","ã/ã‚®","ã/ã‚°","ã’/ã‚²","ã”/ã‚´"],
            ["z","ã–/ã‚¶","ã˜/ã‚¸ (ji/zi)","ãš/ã‚º","ãœ/ã‚¼","ã/ã‚¾"],
            ["d","ã /ãƒ€","ã¢/ãƒ‚ (di/ji)","ã¥/ãƒ… (du/zu)","ã§/ãƒ‡","ã©/ãƒ‰"],
            ["b","ã°/ãƒ","ã³/ãƒ“","ã¶/ãƒ–","ã¹/ãƒ™","ã¼/ãƒœ"]
        ],
        handakuten: [
            ["","a","i","u","e","o"],
            ["p","ã±/ãƒ‘","ã´/ãƒ”","ã·/ãƒ—","ãº/ãƒš","ã½/ãƒ"]
        ]
    };

    let selected = [], current = 0, score = 0, total = 0, lang = "zh";

    const texts = {
        zh: {
            title: "ğŸŒ æ—¥æ–‡äº”åéŸ³ç·´ç¿’å™¨",
            navPractice: "ç·´ç¿’æ¨¡å¼",
            navChart: "äº”åéŸ³è¡¨",
            typeHiragana: "å¹³å‡å (ã²ã‚‰ãŒãª)",
            typeKatakana: "ç‰‡å‡å (ã‚«ã‚¿ã‚«ãƒŠ)",
            typeMixed: "æ··åˆç·´ç¿’",
            groupBasic: "åŸºæœ¬éŸ³",
            groupDakuten: "æ¿éŸ³",
            groupHandakuten: "åŠæ¿éŸ³",
            groupYouon: "æ‹—éŸ³",
            groupSokuon: "ä¿ƒéŸ³",
            groupChouon: "é•·éŸ³",
            sokuonDesc: "å°ã¤ (ã£)ï¼Œç™¼éŸ³æ™‚åœé “ä¸€æ‹<br>ä¾‹ï¼šãã£ã· (kippu)ã€ãŒã£ã“ã† (gakkou)",
            chouonDesc: "æ¯éŸ³å»¶é•·ï¼ŒæŒçºŒå…©æ‹<br>ä¾‹ï¼šãŠã‹ã‚ã•ã‚“ (okaasan)ã€ã‚³ãƒ¼ãƒ’ãƒ¼ (koohii)",
            backBtn: "è¿”å›ä¸»é¸å–®",
            quizTitle: "ç·´ç¿’æ¨¡å¼",
            catBasic: "æ¸…éŸ³",
            catDakuten: "æ¿éŸ³ (ãŒ,ã–,ã ,ã°)",
            catHandakuten: "åŠæ¿éŸ³ (ã±è¡Œ)",
            catYouon: "æ‹—éŸ³ (ãã‚ƒ,ã—ã‚ƒ,ã¡ã‚ƒ...)",
            catSokuon: "ä¿ƒéŸ³ (ãã£ã·,ãŒã£ã“ã†...)",
            catChouon: "é•·éŸ³ (ãŠã‹ã‚ã•ã‚“,ã‚³ãƒ¼ãƒ’ãƒ¼...)",
            catBasicKatakana: "æ¸…éŸ³",
            catDakutenKatakana: "æ¿éŸ³ (ã‚¬,ã‚¶,ãƒ€,ãƒ)",
            catHandakutenKatakana: "åŠæ¿éŸ³ (ãƒ‘è¡Œ)",
            catYouonKatakana: "æ‹—éŸ³ (ã‚­ãƒ£,ã‚·ãƒ£,ãƒãƒ£...)",
            catSokuonKatakana: "ä¿ƒéŸ³ (ãƒã‚±ãƒƒãƒˆ,ã‚µãƒƒã‚«ãƒ¼...)",
            catChouonKatakana: "é•·éŸ³ (ã‚³ãƒ¼ãƒ’ãƒ¼,ã‚±ãƒ¼ã‚­...)",
            startBtn: "é–‹å§‹ç·´ç¿’",
            submitBtn: "é€å‡º",
            correct: "âœ… æ­£ç¢ºï¼",
            wrong: c => `âŒ éŒ¯èª¤ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ ${c}`,
            finalScore: (s, t) => `ğŸŒŸ ç·´ç¿’å®Œæˆï¼å¾—åˆ†ï¼š${s} / ${t} (${Math.round(s/t*100)}%)`,
            alert: "âš ï¸ è«‹è‡³å°‘é¸æ“‡ä¸€ç¨®ç·´ç¿’é¡å‹ï¼",
            statCurrent: "ç•¶å‰é¡Œç›®",
            statTotal: "ç¸½é¡Œæ•¸",
            statScore: "æ­£ç¢ºæ•¸",
            statAccuracy: "æ­£ç¢ºç‡",
            answerPlaceholder: "è¼¸å…¥ç¾…é¦¬æ‹¼éŸ³",
            chartHiragana: "å¹³å‡å",
            chartKatakana: "ç‰‡å‡å"
        },
        en: {
            title: "ğŸŒ 50 Sounds Practice",
            navPractice: "Practice Mode",
            navChart: "Kana Chart",
            typeHiragana: "Hiragana (ã²ã‚‰ãŒãª)",
            typeKatakana: "Katakana (ã‚«ã‚¿ã‚«ãƒŠ)",
            typeMixed: "Mixed Practice",
            groupBasic: "Basic",
            groupDakuten: "Dakuon",
            groupHandakuten: "Handakuon",
            groupYouon: "Youon",
            groupSokuon: "Sokuon",
            groupChouon: "Long Vowels",
            sokuonDesc: "Small tsu (ã£), pause for one beat<br>Ex: ãã£ã· (kippu), ãŒã£ã“ã† (gakkou)",
            chouonDesc: "Extended vowels, hold for two beats<br>Ex: ãŠã‹ã‚ã•ã‚“ (okaasan), ã‚³ãƒ¼ãƒ’ãƒ¼ (koohii)",
            backBtn: "Back to Menu",
            quizTitle: "Practice Mode",
            catBasic: "Clear sounds",
            catDakuten: "Voiced sounds (ga,za,da,ba)",
            catHandakuten: "Semi-voiced sounds (pa)",
            catYouon: "Contracted sounds (kya,sha,cha...)",
            catSokuon: "Double consonants (kippu,gakkou...)",
            catChouon: "Long vowels (okaasan,koohii...)",
            catBasicKatakana: "Clear sounds",
            catDakutenKatakana: "Voiced sounds (GA,ZA,DA,BA)",
            catHandakutenKatakana: "Semi-voiced sounds (PA)",
            catYouonKatakana: "Contracted sounds (KYA,SHA,CHA...)",
            catSokuonKatakana: "Double consonants (chiketto,sakkaa...)",
            catChouonKatakana: "Long vowels (koohii,keeki...)",
            startBtn: "Start Practice",
            submitBtn: "Submit",
            correct: "âœ… Correct!",
            wrong: c => `âŒ Incorrect, correct answer: ${c}`,
            finalScore: (s, t) => `ğŸŒŸ Practice Complete! Score: ${s} / ${t} (${Math.round(s/t*100)}%)`,
            alert: "âš ï¸ Please select at least one practice type!",
            statCurrent: "Current",
            statTotal: "Total",
            statScore: "Correct",
            statAccuracy: "Accuracy",
            answerPlaceholder: "Enter romaji",
            chartHiragana: "Hiragana",
            chartKatakana: "Katakana"
        }
    };

    function setLanguage() {
        lang = document.getElementById("language").value;
        const t = texts[lang];
        
        document.getElementById("title").innerText = t.title;
        
        // æ›´æ–°ä½œè€…ä¿¡æ¯
        const authorElement = document.querySelector('p');
        if (lang === 'zh') {
            authorElement.innerText = "ä½œè€…: Ingee";
        } else {
            authorElement.innerText = "Author: Ingee";
        }
        
        document.getElementById("nav-practice").innerText = t.navPractice;
        document.getElementById("nav-chart").innerText = t.navChart;
        document.getElementById("type-hiragana").innerText = t.typeHiragana;
        document.getElementById("type-katakana").innerText = t.typeKatakana;
        document.getElementById("type-mixed").innerText = t.typeMixed;
        document.getElementById("group-basic").innerText = t.groupBasic;
        document.getElementById("group-dakuten").innerText = t.groupDakuten;
        document.getElementById("group-handakuten").innerText = t.groupHandakuten;
        document.getElementById("group-youon").innerText = t.groupYouon;
        document.getElementById("group-sokuon").innerText = t.groupSokuon;
        document.getElementById("group-chouon").innerText = t.groupChouon;
        document.getElementById("sokuon-desc").innerHTML = t.sokuonDesc;
        document.getElementById("chouon-desc").innerHTML = t.chouonDesc;
        const backBtnEl = document.getElementById("back-btn");
        if (backBtnEl) backBtnEl.innerText = t.backBtn;
        const quizTitleEl = document.getElementById("quiz-title");
        if (quizTitleEl) quizTitleEl.innerText = t.quizTitle;
        document.getElementById("cat-basic").innerText = t.catBasic;
        document.getElementById("cat-dakuten").innerText = t.catDakuten;
        document.getElementById("cat-handakuten").innerText = t.catHandakuten;
        document.getElementById("cat-youon").innerText = t.catYouon;
        // Move start and submit button updates here
        document.getElementById("start-btn").innerText = t.startBtn;
        document.getElementById("submit-btn").innerText = t.submitBtn;
        document.getElementById("stat-current").innerText = t.statCurrent;
        document.getElementById("stat-total").innerText = t.statTotal;
        document.getElementById("stat-score").innerText = t.statScore;
        document.getElementById("stat-accuracy").innerText = t.statAccuracy;
        document.getElementById("answer").placeholder = t.answerPlaceholder;
        // Update chart tab labels
        const chartHiraEl = document.getElementById("chart-hiragana-label");
        if (chartHiraEl) chartHiraEl.innerText = t.chartHiragana;
        const chartKataEl = document.getElementById("chart-katakana-label");
        if (chartKataEl) chartKataEl.innerText = t.chartKatakana;
        updateChart();
    }

    function showTab(tabName) {
        // å…ˆéš±è—æ‰€æœ‰ tab-content
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
            tab.style.display = 'none';
        });
        // å…ˆç§»é™¤æ‰€æœ‰ nav-tab çš„ active
        document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));

        // é¡¯ç¤ºå°æ‡‰ tab
        const currentTab = document.getElementById(tabName + '-tab');
        if (currentTab) {
            currentTab.classList.add('active');
            currentTab.style.display = 'block';
        }
        // å°æ‡‰ nav-tab åŠ  active
        if (event && event.target) {
            event.target.closest('.nav-tab').classList.add('active');
        }

        // æ§åˆ¶ã€Œé–‹å§‹ç·´ç¿’ã€æŒ‰éˆ•é¡¯ç¤º
        const startBtn = document.getElementById("start-btn");
        if (startBtn) {
            if (tabName === 'practice') {
                startBtn.style.display = "";
                startBtn.innerText = texts[lang].startBtn;
            } else {
                startBtn.style.display = "none";
            }
        }

        if (tabName === 'chart') {
            updateChart();
            console.log("Chart updated");
        }
    }

    function updateKanaType() {
        // å‡åé¡å‹æ›´æ–°æ™‚å¯ä»¥æ·»åŠ é‚è¼¯
    }

    function shuffle(array) {
        const newArray = [...array];
        for (let i = newArray.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
        }
        return newArray;
    }

    function startQuiz() {
        console.log("startQuiz called");
        
        // æ¸…ç†ä¹‹å‰çš„ç·´ç¿’ç‹€æ…‹
        const existingQuizArea = document.getElementById("quiz-area");
        if (existingQuizArea) {
            existingQuizArea.style.display = "none";
        }
        const inlineQuiz = document.getElementById("inline-quiz");
        if (inlineQuiz) {
            inlineQuiz.remove();
        }
        const existingQuizHeader = document.getElementById("quiz-header");
        if (existingQuizHeader) {
            existingQuizHeader.remove();
        }
        
        const kanaTypeEl = document.querySelector('input[name="kana-type"]:checked');
        if (!kanaTypeEl) {
            console.log("No kana type selected");
            return;
        }
        
        const kanaType = kanaTypeEl.value;
        const categories = Array.from(document.querySelectorAll('input[name="category"]:checked')).map(cb => cb.value);
        
        if (categories.length === 0) {
            alert(texts[lang].alert);
            return;
        }

        let kanaList = [];
        categories.forEach(category => {
            if (kanaData[category]) {
                if (kanaType === 'mixed') {
                    if (kanaData[category].hiragana) kanaList.push(...kanaData[category].hiragana);
                    if (kanaData[category].katakana) kanaList.push(...kanaData[category].katakana);
                } else {
                    if (kanaData[category][kanaType]) kanaList.push(...kanaData[category][kanaType]);
                }
            }
        });

        if (kanaList.length === 0) {
            console.log("No kana data found");
            return;
        }

        selected = shuffle(kanaList);
        current = 0;
        score = 0;
        total = selected.length;
        
        // é€²å…¥ç·´ç¿’æ¨¡å¼ - éš±è—ä¸»é¸å–®å…§å®¹ï¼Œé¡¯ç¤ºç·´ç¿’å…§å®¹
        const practiceTab = document.getElementById("practice-tab");
        const chartTab = document.getElementById("chart-tab");
        const navTabs = document.querySelector(".nav-tabs");
        const languageSelect = document.querySelector('div[style*="margin-bottom: 20px"]');
        
        console.log("Hiding menu elements...");
        
        if (practiceTab) {
            // éš±è—é¸é …å€åŸŸ
            const checkboxGrid = practiceTab.querySelector(".checkbox-grid");
            const modeSelect = practiceTab.querySelector(".mode-select");
            const startBtn = document.getElementById("start-btn");
            
            if (checkboxGrid) {
                checkboxGrid.style.display = "none";
                console.log("Checkbox grid hidden");
            }
            if (modeSelect) {
                modeSelect.style.display = "none";
                console.log("Mode select hidden");
            }
            if (startBtn) {
                startBtn.style.display = "none";
                console.log("Start button hidden");
            }
            if (navTabs) {
                navTabs.style.display = "none";
                console.log("Nav tabs hidden");
            }
            if (chartTab) {
                chartTab.style.display = "none";
                console.log("Chart tab hidden");
            }
            if (languageSelect) {
                languageSelect.style.display = "none";
                console.log("Language select hidden");
            }
            
            // å‰µå»ºç·´ç¿’é é¢é ‚éƒ¨å°èˆª
            let quizHeader = document.createElement("div");
            quizHeader.id = "quiz-header";
            quizHeader.style.cssText = "display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding: 15px; background: rgba(255,255,255,0.9); border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);";
            
            const backButton = document.createElement("button");
            backButton.innerHTML = "â† " + texts[lang].backBtn;
            backButton.style.cssText = "background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 14px;";
            backButton.onclick = returnToMenu;
            
            const title = document.createElement("h2");
            title.style.cssText = "margin: 0; color: #2c3e50;";
            title.innerText = texts[lang].quizTitle;
            
            const spacer = document.createElement("div");
            spacer.style.width = "120px";
            
            quizHeader.appendChild(backButton);
            quizHeader.appendChild(title);
            quizHeader.appendChild(spacer);
            
            practiceTab.insertBefore(quizHeader, practiceTab.firstChild);
            console.log("Quiz header created");
        }
        
        // å¼·åˆ¶é¡¯ç¤ºæ¸¬é©—å…§å®¹
        console.log("Force showing quiz content...");
        
        // ç›´æ¥åœ¨é€™è£¡é¡¯ç¤ºæ¸¬é©—å€åŸŸ
        const quizArea = document.getElementById("quiz-area");
        console.log("Direct quiz area check:", quizArea);
        
        if (quizArea) {
            quizArea.style.display = "block";
            quizArea.style.visibility = "visible";
            quizArea.style.opacity = "1";
            quizArea.style.position = "relative";
            quizArea.style.zIndex = "1000";
            quizArea.style.backgroundColor = "rgba(255,255,255,0.95)";
            quizArea.style.padding = "20px";
            quizArea.style.borderRadius = "10px";
            quizArea.style.marginTop = "20px";
            console.log("Quiz area shown directly with enhanced styles");
        } else {
            console.log("Quiz area NOT found - creating inline");
            // ç›´æ¥å‰µå»ºæ¸¬é©—å…§å®¹
            const practiceTab = document.getElementById("practice-tab");
            if (practiceTab) {
                const inlineQuiz = document.createElement("div");
                inlineQuiz.id = "inline-quiz";
                inlineQuiz.innerHTML = `
                    <div style="font-size: 72px; margin: 20px; color: #2c3e50; text-align: center;" id="kana"></div>
                    <div style="text-align: center; margin: 20px;">
                        <input id="answer" placeholder="è¼¸å…¥ç¾…é¦¬æ‹¼éŸ³" style="padding: 12px; font-size: 16px; border: 2px solid #ddd; border-radius: 8px; margin: 5px;">
                        <br><br>
                        <button onclick="checkAnswer()" id="submit-btn" style="padding: 12px 24px; font-size: 16px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">é€å‡º</button>
                        <div id="feedback" style="font-size: 18px; margin: 20px; font-weight: 500;"></div>
                        <img src="å’–æ³¢ç¨®å­.gif" alt="å’–æ³¢ç¨®å­ GIF" style="width:300px; height:auto; margin-top: 20px;">
                    </div>
                `;
                practiceTab.appendChild(inlineQuiz);
                console.log("Inline quiz created");
            }
        }
        
        const totalNumEl = document.getElementById("total-num");
        if (totalNumEl) {
            totalNumEl.innerText = total;
            console.log("Total number set to:", total);
        }
        
        console.log("Calling updateStats...");
        updateStats();
        console.log("Calling nextQuestion...");
        nextQuestion();
        console.log("Quiz started successfully");
        showQuizContent();
    }

    function showQuizContent() {
        // ç¢ºä¿æ‰€æœ‰ç·´ç¿’ç›¸é—œçš„å…ƒç´ éƒ½é¡¯ç¤º
        const elementsToShow = [
            "progress", "current-num", "total-num", "score-num", "accuracy",
            "stat-current", "stat-total", "stat-score", "stat-accuracy",
            "kana", "answer", "submit-btn", "feedback"
        ];
        
        elementsToShow.forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.style.display = "";
            }
        });
        
        // ç¢ºä¿é€²åº¦æ¢å®¹å™¨é¡¯ç¤º
        const progressBar = document.querySelector(".progress-bar");
        if (progressBar) progressBar.style.display = "block";
        
        // ç¢ºä¿çµ±è¨ˆå€åŸŸé¡¯ç¤º
        const stats = document.querySelector(".stats");
        if (stats) stats.style.display = "flex";
        
        // ç¢ºä¿æ¸¬é©—å®¹å™¨é¡¯ç¤º
        const quizContainer = document.querySelector(".quiz-container");
        if (quizContainer) quizContainer.style.display = "flex";
        
        // ç¢ºä¿å’–æ³¢ç¨®å­é¡¯ç¤º
        const kaboImg = document.querySelector('img[alt="å’–æ³¢ç¨®å­ GIF"]');
        if (kaboImg) {
            kaboImg.style.display = "block";
        }
    }

    function returnToMenu() {
        console.log("Returning to menu...");
        
        // è¿”å›ä¸»é¸å–® - é¡¯ç¤ºä¸»é¸å–®å…§å®¹ï¼Œéš±è—ç·´ç¿’å…§å®¹
        const practiceTab = document.getElementById("practice-tab");
        const chartTab = document.getElementById("chart-tab");
        const navTabs = document.querySelector(".nav-tabs");
        const languageSelect = document.querySelector('div[style*="margin-bottom: 20px"]');
        const quizHeader = document.getElementById("quiz-header");
        
        if (practiceTab) {
            // é¡¯ç¤ºé¸é …å€åŸŸ
            const checkboxGrid = practiceTab.querySelector(".checkbox-grid");
            const modeSelect = practiceTab.querySelector(".mode-select");
            const startBtn = document.getElementById("start-btn");
            
            if (checkboxGrid) {
                checkboxGrid.style.display = "";
                console.log("Checkbox grid restored");
            }
            if (modeSelect) {
                modeSelect.style.display = "";
                console.log("Mode select restored");
            }
            if (startBtn) {
                startBtn.style.display = "";
                console.log("Start button restored");
            }
            if (navTabs) {
                navTabs.style.display = "";
                console.log("Nav tabs restored");
            }
            if (languageSelect) {
                languageSelect.style.display = "";
                console.log("Language select restored");
            }
            if (quizHeader) {
                quizHeader.style.display = "none";
                console.log("Quiz header hidden");
            }
        }
        
        // ä¿®æ­£ï¼šä¸è¦ç›´æ¥è¨­ display: noneï¼Œè®“ tab åˆ‡æ›æ™‚è‡ªå‹•ç®¡ç†
        if (chartTab) {
            chartTab.classList.remove('active');
            console.log("Chart tab reset (remove active class)");
        }
        
        // éš±è—æ¸¬é©—å…§å®¹
        hideQuizContent();
        
        console.log("Returned to main menu");
    }

    function hideQuizContent() {
        // éš±è— quiz-area
        const quizArea = document.getElementById("quiz-area");
        if (quizArea) quizArea.style.display = "none";

        // éš±è—é€²åº¦æ¢å®¹å™¨
        const progressBar = document.querySelector(".progress-bar");
        if (progressBar) progressBar.style.display = "none";
        
        // éš±è—çµ±è¨ˆå€åŸŸ
        const stats = document.querySelector(".stats");
        if (stats) stats.style.display = "none";
        
        // éš±è—æ¸¬é©—å®¹å™¨
        const quizContainer = document.querySelector(".quiz-container");
        if (quizContainer) quizContainer.style.display = "none";
        
        // éš±è—å‡åé¡¯ç¤º
        const kanaEl = document.getElementById("kana");
        if (kanaEl) kanaEl.innerText = "";
        
        // éš±è—å’–æ³¢ç¨®å­
        const kaboImg = document.querySelector('img[alt="å’–æ³¢ç¨®å­ GIF"]');
        if (kaboImg) {
            kaboImg.style.display = "none";
        }
        
        // æ¸…é™¤åé¥‹
        const feedbackEl = document.getElementById("feedback");
        if (feedbackEl) feedbackEl.innerText = "";
    }

    function updateStats() {
        const currentEl = document.getElementById("current-num");
        const scoreEl = document.getElementById("score-num");
        const accuracyEl = document.getElementById("accuracy");
        const progressEl = document.getElementById("progress");
        
        if (currentEl) currentEl.innerText = current + 1;
        if (scoreEl) scoreEl.innerText = score;
        if (accuracyEl) accuracyEl.innerText = current > 0 ? Math.round(score / current * 100) + "%" : "0%";
        
        if (progressEl) {
            const progress = ((current) / total) * 100;
            progressEl.style.width = progress + "%";
        }
    }

    function nextQuestion() {
        console.log("nextQuestion called, current:", current, "total:", total);
        
        const kanaEl = document.getElementById("kana");
        const answerEl = document.getElementById("answer");
        const submitBtnEl = document.getElementById("submit-btn");
        const feedbackEl = document.getElementById("feedback");
        
        console.log("Kana element:", kanaEl);
        console.log("Answer element:", answerEl);
        
        if (current >= selected.length) {
            if (kanaEl) {
                kanaEl.innerText = texts[lang].finalScore(score, total);
                console.log("Final score displayed");
            }
            if (answerEl) answerEl.style.display = "none";
            if (submitBtnEl) submitBtnEl.style.display = "none";
            if (feedbackEl) feedbackEl.innerText = "";
            return;
        }
        
        if (kanaEl) {
            kanaEl.innerText = selected[current][0];
            console.log("Current kana set to:", selected[current][0]);
        }
        if (answerEl) {
            answerEl.value = "";
            answerEl.style.display = "inline";
            setTimeout(() => answerEl.focus(), 100);
            console.log("Answer input reset and focused");
        }
        if (submitBtnEl) submitBtnEl.style.display = "inline";
        if (feedbackEl) feedbackEl.innerText = "";
        
        updateStats();
    }

    function checkAnswer() {
        const answerEl = document.getElementById("answer");
        const feedbackEl = document.getElementById("feedback");
        
        if (!answerEl || !feedbackEl) return;
        
        const user = answerEl.value.trim().toLowerCase();
        const char = selected[current][0];
        const correctAnswers = selected[current][1];
        
        // è™•ç†å¤šç¨®è®€éŸ³çš„æƒ…æ³
        let acceptableAnswers = [];
        if (correctAnswers.includes('/')) {
            acceptableAnswers = correctAnswers.split('/');
        } else {
            acceptableAnswers = [correctAnswers];
        }
        
        // ç‰¹æ®Šæƒ…æ³è™•ç†
        if (char === "ã‚’" || char === "ãƒ²") {
            acceptableAnswers = ["wo", "o"];
        }
        if (char === "ã¢" || char === "ãƒ‚") {
            acceptableAnswers = ["di", "ji"];
        }
        if (char === "ã¥" || char === "ãƒ…") {
            acceptableAnswers = ["du", "zu"];
        }
        if (char === "ã˜" || char === "ã‚¸") {
            acceptableAnswers = ["ji", "zi"];
        }
        
        if (acceptableAnswers.includes(user)) {
            feedbackEl.innerText = texts[lang].correct;
            feedbackEl.style.color = "#27ae60";
            score++;
        } else {
            const answerDisplay = acceptableAnswers.length > 1 ? 
                acceptableAnswers.join(' / ') : acceptableAnswers[0];
            feedbackEl.innerText = texts[lang].wrong(answerDisplay);
            feedbackEl.style.color = "#e74c3c";
        }
        
        current++;
        setTimeout(nextQuestion, 1500);
    }

    function updateChart() {
        console.log("updateChart called");
        
        const chartType = document.querySelector('input[name="chart-type"]:checked');
        if (!chartType) {
            console.log("No chart type selected, defaulting to hiragana");
            // å¦‚æœæ‰¾ä¸åˆ°é¸ä¸­çš„é¡å‹ï¼Œé»˜èªç‚ºå¹³å‡å
            const hiraganaRadio = document.querySelector('input[name="chart-type"][value="hiragana"]');
            if (hiraganaRadio) hiraganaRadio.checked = true;
        }
        
        const selectedType = chartType ? chartType.value : 'hiragana';
        console.log("Chart type:", selectedType);
        
        const chartContainer = document.getElementById("kana-chart");
        console.log("Chart container:", chartContainer);
        
        if (!chartContainer) {
            console.log("Chart container not found!");
            return;
        }
        
        let html = "";
        
        // åŸºæœ¬éŸ³è¡¨
        html += "<h3>æ¸…éŸ³</h3>";
        html += createChartTable(chartData.basic, selectedType);
        
        // æ¿éŸ³è¡¨
        html += "<h3>æ¿éŸ³</h3>";
        html += createChartTable(chartData.dakuten, selectedType);
        
        // åŠæ¿éŸ³è¡¨
        html += "<h3>åŠæ¿éŸ³</h3>";
        html += createChartTable(chartData.handakuten, selectedType);
        
        // æ‹—éŸ³è¡¨
        html += "<h3>æ‹—éŸ³</h3>";
        html += createYouonTable(selectedType);
        
        console.log("Generated HTML length:", html.length);
        console.log("HTML preview:", html.substring(0, 200) + "...");
        
        chartContainer.innerHTML = html;
        console.log("Chart container updated");
    }

    function createChartTable(data, type) {
        console.log("createChartTable called with type:", type);
        console.log("Data:", data);
        
        let html = '<table class="chart-table" style="width: 100%; border-collapse: collapse; margin: 20px 0; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">';
        
        data.forEach((row, index) => {
            html += '<tr>';
            row.forEach((cell, cellIndex) => {
                const cellStyle = index === 0 ? 
                    'style="padding: 12px; text-align: center; border: 1px solid #e9ecef; background: #667eea; color: white; font-weight: 600;"' :
                    'style="padding: 12px; text-align: center; border: 1px solid #e9ecef; font-size: 18px;"';
                
                if (index === 0) {
                    html += `<th ${cellStyle}>${cell}</th>`;
                } else {
                    if (cellIndex === 0) {
                        html += `<th ${cellStyle}>${cell}</th>`;
                    } else {
                        if (cell === "") {
                            html += '<td style="padding: 12px; text-align: center; border: 1px solid #e9ecef;"></td>';
                        } else {
                            // æª¢æŸ¥æ˜¯å¦åŒ…å«æ‹¬è™Ÿï¼ˆå¤šç¨®è®€éŸ³ï¼‰
                            if (cell.includes('(')) {
                                // æœ‰æ‹¬è™Ÿçš„æƒ…æ³ï¼Œç›´æ¥é¡¯ç¤º
                                const kanaChars = cell.split(' (')[0].split('/');
                                const displayChar = type === 'hiragana' ? kanaChars[0] : kanaChars[1];
                                const romajiPart = cell.split(' (')[1].replace(')', '');
                                html += `<td style="padding: 12px; text-align: center; border: 1px solid #e9ecef;">
                                    <div style="font-size: 24px; font-weight: bold; color: #2c3e50;">${displayChar}</div>
                                    <div style="font-size: 14px; color: #666; font-family: monospace;">${romajiPart}</div>
                                </td>`;
                            } else {
                                // æ™®é€šæƒ…æ³ï¼ŒæŸ¥æ‰¾ç¾…é¦¬å­—
                                const kanaChars = cell.split('/');
                                const displayChar = type === 'hiragana' ? kanaChars[0] : kanaChars[1];
                                const romaji = getRomajiForKana(displayChar);
                                html += `<td style="padding: 12px; text-align: center; border: 1px solid #e9ecef;">
                                    <div style="font-size: 24px; font-weight: bold; color: #2c3e50;">${displayChar}</div>
                                    <div style="font-size: 14px; color: #666; font-family: monospace;">${romaji}</div>
                                </td>`;
                            }
                        }
                    }
                }
            });
            html += '</tr>';
        });
        
        html += '</table>';
        console.log("Generated table HTML length:", html.length);
        return html;
    }

    function createYouonTable(type) {
        const youonGroups = [
            {name: "ãã‚ƒè¡Œ", kana: ["ãã‚ƒ/ã‚­ãƒ£", "ãã‚…/ã‚­ãƒ¥", "ãã‚‡/ã‚­ãƒ§"], romaji: ["kya", "kyu", "kyo"]},
            {name: "ã—ã‚ƒè¡Œ", kana: ["ã—ã‚ƒ/ã‚·ãƒ£", "ã—ã‚…/ã‚·ãƒ¥", "ã—ã‚‡/ã‚·ãƒ§"], romaji: ["sha", "shu", "sho"]},
            {name: "ã¡ã‚ƒè¡Œ", kana: ["ã¡ã‚ƒ/ãƒãƒ£", "ã¡ã‚…/ãƒãƒ¥", "ã¡ã‚‡/ãƒãƒ§"], romaji: ["cha", "chu", "cho"]},
            {name: "ã«ã‚ƒè¡Œ", kana: ["ã«ã‚ƒ/ãƒ‹ãƒ£", "ã«ã‚…/ãƒ‹ãƒ¥", "ã«ã‚‡/ãƒ‹ãƒ§"], romaji: ["nya", "nyu", "nyo"]},
            {name: "ã²ã‚ƒè¡Œ", kana: ["ã²ã‚ƒ/ãƒ’ãƒ£", "ã²ã‚…/ãƒ’ãƒ¥", "ã²ã‚‡/ãƒ’ãƒ§"], romaji: ["hya", "hyu", "hyo"]},
            {name: "ã¿ã‚ƒè¡Œ", kana: ["ã¿ã‚ƒ/ãƒŸãƒ£", "ã¿ã‚…/ãƒŸãƒ¥", "ã¿ã‚‡/ãƒŸãƒ§"], romaji: ["mya", "myu", "myo"]},
            {name: "ã‚Šã‚ƒè¡Œ", kana: ["ã‚Šã‚ƒ/ãƒªãƒ£", "ã‚Šã‚…/ãƒªãƒ¥", "ã‚Šã‚‡/ãƒªãƒ§"], romaji: ["rya", "ryu", "ryo"]},
            {name: "ãã‚ƒè¡Œ", kana: ["ãã‚ƒ/ã‚®ãƒ£", "ãã‚…/ã‚®ãƒ¥", "ãã‚‡/ã‚®ãƒ§"], romaji: ["gya", "gyu", "gyo"]},
            {name: "ã˜ã‚ƒè¡Œ", kana: ["ã˜ã‚ƒ/ã‚¸ãƒ£", "ã˜ã‚…/ã‚¸ãƒ¥", "ã˜ã‚‡/ã‚¸ãƒ§"], romaji: ["ja", "ju", "jo"]},
            {name: "ã³ã‚ƒè¡Œ", kana: ["ã³ã‚ƒ/ãƒ“ãƒ£", "ã³ã‚…/ãƒ“ãƒ¥", "ã³ã‚‡/ãƒ“ãƒ§"], romaji: ["bya", "byu", "byo"]},
            {name: "ã´ã‚ƒè¡Œ", kana: ["ã´ã‚ƒ/ãƒ”ãƒ£", "ã´ã‚…/ãƒ”ãƒ¥", "ã´ã‚‡/ãƒ”ãƒ§"], romaji: ["pya", "pyu", "pyo"]}
        ];

        let html = '<table class="chart-table">';
        html += '<tr><th>è¡Œ</th><th>ã‚„æ®µ</th><th>ã‚†æ®µ</th><th>ã‚ˆæ®µ</th></tr>';
        
        youonGroups.forEach(group => {
            html += '<tr>';
            html += `<th>${group.name}</th>`;
            group.kana.forEach((kana, index) => {
                const kanaChars = kana.split('/');
                const displayChar = type === 'hiragana' ? kanaChars[0] : kanaChars[1];
                html += `<td>
                    <div class="kana-char">${displayChar}</div>
                    <div class="romaji">${group.romaji[index]}</div>
                </td>`;
            });
            html += '</tr>';
        });
        
        html += '</table>';
        return html;
    }

    function getRomajiForKana(kana) {
        // æŸ¥æ‰¾å‡åå°æ‡‰çš„ç¾…é¦¬å­—
        for (const category in kanaData) {
            for (const type in kanaData[category]) {
                const found = kanaData[category][type].find(item => item[0] === kana);
                if (found) return found[1];
            }
        }
        return "";
    }

    // åˆå§‹åŒ–
    function initializePage() {
        setLanguage();
        updateChart();
        
        // ç¢ºä¿äº‹ä»¶ç›£è½å™¨æ­£ç¢ºç¶å®š
        const startBtn = document.getElementById("start-btn");
        if (startBtn) {
            startBtn.onclick = startQuiz;
        }
        
        console.log("Page initialized"); // èª¿è©¦ä¿¡æ¯
    }
    
    // ç•¶é é¢åŠ è¼‰å®Œæˆæ™‚åˆå§‹åŒ–
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializePage);
    } else {
        initializePage();
    }
    </script>
</body>
</html>
